<% provide(:title, 'ヒヤリ新規作成') %>
<% provide(:button_text, 'ヒヤリ・事故報告書 / 新規作成 ') %>

<h1 class="title-position">ヒヤリ・事故報告書 新規作成</h1>

<%= form_with(model: @senior, url: facility_senior_accidents_path, local: true, method: :post) do |f| %>
  <%= f.fields_for :accidents do |ac| %>
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-md-offset-6">
          <table class="table table-bordered table-condensed sign-table">
            <thead>
              <tr>
                <th class="sign-th">施設長</th>
                <th class="sign-th">次長</th>
                <th class="sign-th">リスマネ</th>
                <th class="sign-th">担当係長</th>
                <th class="sign-th">担当職員</th>
                <th class="sign-th">家族連絡</th>
              </tr>
            </thead>
            <tbody>
              <tr class="sign-box">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td colspan="3">
                  <div class="label-inline-flex-new">
                    <%= ac.label "報告書" %>&emsp;
                    <%= ac.date_select :reporting_date, {prompt: :include_blank}, {class: "form-control bootstrap-date input-sm"} %>
                  </div>
                </td>
                <td colspan="3">
                  <div class="label-inline-flex-new">
                    <%= ac.label "最終報告日" %>&emsp;
                    <%= ac.date_select :last_reporting_date, {prompt: :include_blank}, {class: "form-control bootstrap-date input-sm"} %>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="pull-left">
        <%= ac.label "ヒヤリ・事故選択" %><span class="select-choice">※ 必須</span>
        <%= ac.select :which_accident, {ヒヤリハット: "ヒヤリハット", 事故: "事故"}, {prompt: @accident.which_accident},class: "form-control" %>
      </div>
      <div class="row">
        <div class="col-md-12">
          <table class="table table-bordered table-condensed table-hover sign-table">
            <thead>
              <tr>
                <th class="report-th" colspan="4">部署・報告者</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th class="report-index">部署</th>
                <td class="report-td">
                  <div>
                    <%= ac.select :department, {特養: "特養", 通所: "通所", 居宅サービス: "居宅サービス", 管理: "管理", 栄養: "栄養"},
                                  {prompt: @accident.department}, class: "form-control" %>
                  </div>
                </td>
                <th class="report-index" style="padding-left: 40px">報告者<span class="select-choice">※ 必須</span></th>
                <td class="report-td">
                  <%= ac.select :reporter, Worker.all.where(working_flg: true).order(:worker_name_call).map { |worker| [worker.worker_name, worker.worker_name] },
                                {prompt: @accident.reporter}, class: "form-control" %>
                </td>
              </tr>
            </tbody>

            <thead>
              <tr>
                <th class="report-th" colspan="4">具体的内容</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th class="report-index">日付</th>
                <td class="report-td">
                  <div>
                    <%= ac.date_select :accident_datetime, {use_month_numbers: true}, {class: "form-control bootstrap-date"} %>
                  </div>
                </td>
                <th class="report-index" style="padding-left: 40px">時間<span class="select-choice">※ 必須</span></th>
                <td class="report-td">
                  <%= ac.time_select :accident_time, {prompt: @accident.accident_time, minute_step: 15},{class: "form-control bootstrap-date"} %>
                </td>
              </tr>
              <tr>
                <th class="report-index">対象者</th>
                <td class="report-td">
                  <%= @senior.senior_name %>
                  <%= ac.hidden_field :accident_floor, value: @senior.floor %>
                </td>
                <th class="report-index">関与者</th>
                <td>
                  <%= ac.select :accident_worker, Worker.all.where(working_flg: true).order(:worker_name_call).map { |worker| [worker.worker_name, worker.worker_name] },
                                {prompt: "関与者を選択"}, class: "form-control" %>
                </td>
              </tr>
              <tr>
                <th class="report-index">場所</th>
                  <td class="report-td">
                    <%= ac.text_field :accident_place, class: "form-control" %>
                  </td>
                <th class="report-index">活動等</th>
                <td class="report-td">
                  <%= ac.text_field :active, class: "form-control" %>
                </td>
              </tr>
              <tr>
                <th class="report-index">状況・職員の動き<div class="select-choice">※ 必須</div></th>
                <td class="report-td-left" colspan="3">
                  <%= ac.text_area :accident_scene, value: @accident.accident_scene, rows: 3, class: 'form-control',
                                   placeholder: "ヒヤリ・事故が起こった状況の詳細を記載" %>
                </td>
              </tr>
              <tr>
                <th class="report-index">結果</th>
                <td class="report-td-left" colspan="3">
                  <div class="radio-inline">
                    <%= ac.radio_button :accident_result, "ヒヤリのみ", checked: "checked" %>
                    <%= ac.label "ヒヤリのみ" %>
                  </div><br>
                  <div class="radio-inline">
                    <%= ac.radio_button :accident_result, "軽事故等" %>
                    <%= ac.label "軽事故等" %>
                    <%= ac.text_field :accident_result_comment, class: "form-control" %>
                  </div>
                </td>
              </tr>
            </tbody>
            <thead>
            <tr>
              <th class="report-th" colspan="2">場面・活動状況</th>
              <th class="report-th" colspan="2">出来事の領域別分類</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td class="report-td" style="width: 15%;">
                <%= ac.select :activity_scene, Accident.activity_scenes.keys.to_a, {}, { class: "form-control" } %></td>
              <td class="report-td">
                <%= ac.text_field :other_activity_scene, placeholder: "※「その他」は具体的に記載", class: "form-control" %>
              </td>
              <td class="report-td" style="width: 15%;">
                <%= ac.select :event_classification, Accident.event_classifications.keys.to_a, {}, { class: "form-control" } %>
              </td>
              <td class="report-td">
                <%= ac.text_field :other_event, placeholder: "※「その他」は具体的に記載", class: "form-control" %>
              </td>
            </tr>
            </tbody>
            <thead>
              <tr>
                <th class="report-th" colspan="4">原因・対策・効果等</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th class="report-index">原因・要因</th>
                <td class="report-td-left" colspan="2">
                  <%= ac.text_area :result_comment, value: @accident.result_comment, rows: 3, class: 'form-control',
                                   placeholder: "具体的な原因・要因を記載" %>
                </td>
                <td class="report-td-left">

                  <div class="field">
                    <% @result_worker.each do |item| %>
                        <%= check_box_tag 'senior[accidents][result_worker][]', item %>
                        <%= item %>
                    <% end %>
                  </div>
                </td>

              </tr>
              <tr>
                <th class="report-index">教訓・対策</th>
                <td class="report-td-left" colspan="3">
                  <%= ac.text_area :measures_comment, value: @accident.measures_comment, rows: 3, class: 'form-control',
                                   placeholder: "フロミ後、教訓・対策を記載" %>
                </td>
              </tr>
              <tr>
                <th class="report-index">対策変更</th>
                <td class="report-td-left" colspan="3"></td>
              </tr>
              <tr>
                <th class="report-index">効果<br>（翌月評価）</th>
                <td class="report-td-left" colspan="2"></td>
                <td class="report-td-left"></td>
              </tr>
              <tr>
                <th class="report-index">責任者等<br>コメント</th>
                <td class="report-td-left" colspan="3"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-4 col-md-offset-8">
          <table class="table table-bordered table-condensed sign-table">
            <thead>
            <tr>
              <th class="sign-th">施設長</th>
              <th class="sign-th">次長</th>
              <th class="sign-th">リスマネ</th>
              <th class="sign-th">担当係長</th>
            </tr>
            </thead>
            <tbody>
            <tr class="sign-box">
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>
  <%= f.submit yield(:button_text), class: "btn btn-primary btn-block btn-#{yield(:class_text)}" %>
<% end %>




